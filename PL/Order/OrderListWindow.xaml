<Window x:Class="PL.Order.OrderListWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PL.Order"
        xmlns:bo="clr-namespace:BO;assembly=BL"
        xmlns:pl="clr-namespace:PL"
        mc:Ignorable="d"
        Title="Order Management" Height="750" Width="1100"
        DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}"
        Background="#F5F7FA"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Converters -->
        <pl:OrderStatusToCancelVisibilityConverter x:Key="OrderStatusToCancelVisibilityConverter"/>
        
        <!-- Enum collections for ComboBox bindings -->
        <ObjectDataProvider x:Key="OrderStatusCollection" MethodName="GetValues" ObjectType="{x:Type bo:OrderStatus}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="bo:OrderStatus"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        
        <ObjectDataProvider x:Key="OrderTypeCollection" MethodName="GetValues" ObjectType="{x:Type bo:OrderType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="bo:OrderType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <!-- Modern Button Template -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                BorderThickness="0"
                                Padding="12,8">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- Small Button Style -->
        <Style x:Key="SmallButton" TargetType="Button" BasedOn="{StaticResource ModernButton}">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="6"
                                BorderThickness="0"
                                Padding="8,5">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Card Style -->
        <Style x:Key="CardPanel" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="18"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" BlurRadius="12" ShadowDepth="3" Opacity="0.1"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern ComboBox Style -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#F5F7FA"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Modern DataGrid Style -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="AlternatingRowBackground" Value="#F9FAFB"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Order Management" 
                   FontSize="28" 
                   FontWeight="Bold" 
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <!-- Filter Panel -->
        <Border Grid.Row="1" Style="{StaticResource CardPanel}" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="Order Type:" 
                           VerticalAlignment="Center"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="#555"
                           Margin="0,0,10,0"/>

                <ComboBox Grid.Column="1" 
                          ItemsSource="{Binding Source={StaticResource OrderTypeCollection}}"
                          SelectedItem="{Binding SelectedOrderType, Mode=TwoWay}"
                          SelectionChanged="FilterComboBox_SelectionChanged"
                          Style="{StaticResource ModernComboBox}"
                          VerticalAlignment="Center">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <TextBlock Grid.Column="3" 
                           Text="Order Status:" 
                           VerticalAlignment="Center"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Foreground="#555"
                           Margin="0,0,10,0"/>

                <ComboBox Grid.Column="4" 
                          Name="cmbOrderStatus"
                          SelectionChanged="FilterComboBox_SelectionChanged"
                          Style="{StaticResource ModernComboBox}"
                          VerticalAlignment="Center">
                    <ComboBox.ItemsSource>
                        <CompositeCollection>
                            <ComboBoxItem Content="All" />
                            <CollectionContainer Collection="{Binding Source={StaticResource OrderStatusCollection}}" />
                        </CompositeCollection>
                    </ComboBox.ItemsSource>
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <Button Grid.Column="6" 
                        Content="Clear Filters" 
                        Click="ClearFilters_Click"
                        Style="{StaticResource ModernButton}"
                        Background="#95A5A6"
                        Width="130"
                        Height="35"/>
            </Grid>
        </Border>

        <!-- DataGrid -->
        <Border Grid.Row="2" Style="{StaticResource CardPanel}">
            <DataGrid ItemsSource="{Binding OrderList}" 
                      SelectedItem="{Binding SelectedOrder}" 
                      MouseDoubleClick="OrderList_MouseDoubleClick" 
                      IsReadOnly="True"
                      Style="{StaticResource ModernDataGrid}"
                      AutoGenerateColumns="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Order ID" Binding="{Binding Id}" Width="80"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                    <DataGridTextColumn Header="Distance (km)" Binding="{Binding Distance, StringFormat=N2}" Width="110"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                    <DataGridTextColumn Header="Schedule" Binding="{Binding ScheduleStatus}" Width="100"/>
                    <DataGridTextColumn Header="Time Left" Binding="{Binding TimeLeft, StringFormat=hh\\:mm\\:ss}" Width="100"/>
                    <DataGridTextColumn Header="Processing Time" Binding="{Binding TotalProcessingTime, StringFormat=hh\\:mm\\:ss}" Width="130"/>
                    <DataGridTextColumn Header="Deliveries" Binding="{Binding AmountOfDeliveries}" Width="90"/>
                    <DataGridTemplateColumn Header="Actions" Width="90">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Cancel" 
                                        Click="CancelOrder_Click"
                                        Tag="{Binding Id}"
                                        Visibility="{Binding Status, Converter={StaticResource OrderStatusToCancelVisibilityConverter}}"
                                        Style="{StaticResource SmallButton}"
                                        Background="#E74C3C"
                                        Width="75"
                                        Height="28"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Add Order Button -->
        <Button Grid.Row="3" 
                Content="Add Order" 
                Click="AddOrder_Click"
                Style="{StaticResource ModernButton}"
                Background="#8E44AD"
                HorizontalAlignment="Center"
                Width="180"
                Height="45"
                Margin="0,15,0,0"/>
    </Grid>
</Window>
