<Window x:Class="PL.Order.OrderListWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:PL.Order"
        xmlns:bo="clr-namespace:BO;assembly=BL"
        xmlns:pl="clr-namespace:PL"
        mc:Ignorable="d"
        Title="Order Management" Height="700" Width="1000"
        DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- Converters -->
        <pl:OrderStatusToCancelVisibilityConverter x:Key="OrderStatusToCancelVisibilityConverter"/>
        
        <!-- Enum collections for ComboBox bindings -->
        <ObjectDataProvider x:Key="OrderStatusCollection" MethodName="GetValues" ObjectType="{x:Type bo:OrderStatus}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="bo:OrderStatus"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        
        <ObjectDataProvider x:Key="OrderTypeCollection" MethodName="GetValues" ObjectType="{x:Type bo:OrderType}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="bo:OrderType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <Label Grid.Row="0" Content="Orders Management" FontSize="28" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,10"/>

        <!-- Filter Panel -->
        <GroupBox Grid.Row="1" Header="Filters" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <Label Grid.Column="0" Content="Order Type:" VerticalAlignment="Center" Margin="5"/>
                <ComboBox Grid.Column="1" 
                          ItemsSource="{Binding Source={StaticResource OrderTypeCollection}}"
                          SelectedItem="{Binding SelectedOrderType, Mode=TwoWay}"
                          SelectionChanged="FilterComboBox_SelectionChanged"
                          VerticalAlignment="Center" Margin="5">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <Label Grid.Column="3" Content="Order Status:" VerticalAlignment="Center" Margin="5"/>
                <ComboBox Grid.Column="4" 
                          ItemsSource="{Binding Source={StaticResource OrderStatusCollection}}"
                          SelectedItem="{Binding SelectedOrderStatus, Mode=TwoWay}"
                          SelectionChanged="FilterComboBox_SelectionChanged"
                          VerticalAlignment="Center" Margin="5">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <Button Grid.Column="6" Content="Clear Filters" Width="100" Height="30" 
                        Click="ClearFilters_Click" Margin="5"/>
            </Grid>
        </GroupBox>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2" 
                  ItemsSource="{Binding OrderList}" 
                  SelectedItem="{Binding SelectedOrder}" 
                  MouseDoubleClick="OrderList_MouseDoubleClick" 
                  IsReadOnly="True"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  AlternatingRowBackground="LightGray"
                  GridLinesVisibility="Horizontal">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Order ID" Binding="{Binding Id}" Width="80"/>
                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                <DataGridTextColumn Header="Distance (km)" Binding="{Binding Distance, StringFormat=N2}" Width="100"/>
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="120"/>
                <DataGridTextColumn Header="Schedule" Binding="{Binding ScheduleStatus}" Width="100"/>
                <DataGridTextColumn Header="Time Left" Binding="{Binding TimeLeft, StringFormat=hh\\:mm\\:ss}" Width="100"/>
                <DataGridTextColumn Header="Processing Time" Binding="{Binding TotalProcessingTime, StringFormat=hh\\:mm\\:ss}" Width="120"/>
                <DataGridTextColumn Header="Deliveries" Binding="{Binding AmountOfDeliveries}" Width="80"/>
                <DataGridTemplateColumn Header="Actions" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Cancel" 
                                    Click="CancelOrder_Click"
                                    Tag="{Binding Id}"
                                    Visibility="{Binding Status, Converter={StaticResource OrderStatusToCancelVisibilityConverter}}"
                                    Background="#FFD32F2F" 
                                    Foreground="White"
                                    Width="70"
                                    Height="25"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Add Order Button -->
        <Button Grid.Row="3" Content="Add Order" 
                HorizontalAlignment="Center" 
                Height="40" Width="120" 
                FontSize="14"
                Click="AddOrder_Click" 
                Margin="0,10,0,0"/>
    </Grid>
</Window>
